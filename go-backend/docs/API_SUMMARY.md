# 云梦高校科研竞赛管理系统 - 后端API接口总结（更新版）

## 系统概述

**基础URL**: `http://localhost:8080/api`  
**认证方式**: Bearer Token (JWT)  
**数据格式**: JSON  
**字符编码**: UTF-8

## API接口分类

### 1. 认证接口

#### 1.1 用户登录
- **接口**: `POST /api/login`
- **权限**: 无需认证
- **作用**: 用户登录获取JWT令牌
- **参数**: username, password, role
- **返回**: JWT token + 用户信息

---

### 2. 用户管理接口（管理员权限）

#### 2.1 用户列表管理
- **接口**: `GET /api/users`
- **权限**: 管理员
- **作用**: 获取用户列表，支持分页、搜索、筛选
- **参数**: page, size, search, role, status, department, sortBy, sortOrder

#### 2.2 用户详情
- **接口**: `GET /api/users/{id}`
- **权限**: 管理员
- **作用**: 获取指定用户的详细信息

#### 2.3 创建用户
已归档：此文件的内容已移动到 `go-backend/backups/docs_archive/API_SUMMARY.md`。

为避免重复与保持历史可追溯，原始详细内容已复制到归档目录；若需要恢复或合并，请从归档副本提取。

归档位置：`go-backend/backups/docs_archive/API_SUMMARY.md`（2026-01-19）

##### 3.2.1 获取所有项目列表
- **接口**: `GET /api/projects`
- **权限**: 教师、管理员
- **作用**: 获取系统中所有项目的列表，支持筛选和分页

##### 3.2.2 审核项目
- **接口**: `PUT /api/projects/{id}/review`
- **权限**: 教师、管理员
- **作用**: 对项目进行审核，批准或拒绝
- **参数**: status, comments

##### 3.2.3 获取项目审核记录
- **接口**: `GET /api/projects/{id}/reviews`
- **权限**: 教师、管理员
- **作用**: 获取项目的审核历史记录

---

### 4. 教师管理接口（教师、管理员权限）

#### 4.1 获取教师列表
- **接口**: `GET /api/teachers`
- **权限**: 教师、管理员
- **作用**: 获取所有教师用户列表

#### 4.2 获取教师列表（支持院系筛选）【新增】
- **接口**: `GET /api/teachers/filter`
- **权限**: 教师、管理员
- **作用**: 获取教师列表，支持按院系筛选
- **参数**: page, size, search, department, sortBy, sortOrder

#### 4.3 获取当前登录教师的所有指导项目【新增】
- **接口**: `GET /api/teachers/projects`
- **权限**: 教师
- **作用**: 教师获取自己名下所有被绑定学生提交的项目
- **参数**: page, size, search, type, status, studentId, sortBy, sortOrder

#### 4.4 绑定学生和教师
- **接口**: `POST /api/teachers/bind`
- **权限**: 教师、管理员
- **作用**: 建立学生和教师的指导关系
- **参数**: studentId, teacherId

#### 4.5 获取学生的指导教师
- **接口**: `GET /api/teachers/students/{studentId}`
- **权限**: 教师、管理员
- **作用**: 获取指定学生的所有指导教师

#### 4.6 解绑学生和教师
- **接口**: `DELETE /api/teachers/students/{studentId}/teachers/{teacherId}`
- **权限**: 教师、管理员
- **作用**: 解除学生和教师的指导关系

---

### 5. 学生管理接口（学生权限）

#### 5.1 学生绑定教师【新增】
- **接口**: `POST /api/students/bind-teacher`
- **权限**: 学生
- **作用**: 学生主动绑定指导教师
- **参数**: teacherId

---

### 6. 文件管理接口

#### 6.1 文件上传
- **接口**: `POST /api/files/upload`
- **权限**: 所有认证用户
- **作用**: 上传项目相关文件
- **参数**: 文件数据

---

### 7. 管理员专用接口

#### 7.1 仪表板数据
- **接口**: `GET /api/admin/dashboard`
- **权限**: 管理员
- **作用**: 获取系统仪表板统计数据

#### 7.2 用户概览
- **接口**: `GET /api/admin/overview`
- **权限**: 管理员
- **作用**: 获取用户概览信息

#### 7.3 系统日志
- **接口**: `GET /api/admin/logs`
- **权限**: 管理员
- **作用**: 获取系统操作日志

#### 7.4 系统设置
- **接口**: `GET /api/admin/settings`
- **权限**: 管理员
- **作用**: 获取系统配置设置

#### 7.5 更新系统设置
- **接口**: `PUT /api/admin/settings`
- **权限**: 管理员
- **作用**: 更新系统配置设置

#### 7.6 系统健康状态
- **接口**: `GET /api/admin/health`
- **权限**: 管理员
- **作用**: 获取系统运行状态和健康检查

#### 7.7 数据报表
- **接口**: `GET /api/admin/reports`
- **权限**: 管理员
- **作用**: 获取系统数据报表

#### 7.8 导出数据
- **接口**: `GET /api/admin/export`
- **权限**: 管理员
- **作用**: 导出系统数据

#### 7.9 备份状态
- **接口**: `GET /api/admin/backup/status`
- **权限**: 管理员
- **作用**: 获取数据备份状态

#### 7.10 创建备份
- **接口**: `POST /api/admin/backup`
- **权限**: 管理员
- **作用**: 创建系统数据备份

---

## 权限级别说明

### 1. 无需认证
- 登录接口

### 2. 学生权限
- 个人项目管理（创建、修改、提交）
- 查看项目详情
- 文件上传
- 绑定指导教师【新增】

### 3. 教师权限
- 学生权限的所有功能
- 项目审核
- 师生关系管理
- 查看所有项目
- 查看自己的指导项目列表【新增】
- 获取教师列表（支持筛选）【新增】

### 4. 管理员权限
- 教师权限的所有功能
- 用户管理（增删改查）
- 系统管理
- 数据统计和报表

---

## 新增功能特点

### 1. 教师指导项目管理
- 教师可以查看自己指导的所有学生项目
- 支持按项目状态、类型、学生等条件筛选
- 提供完整的项目信息，包括学生详情、成员数量等

### 2. 教师列表筛选
- 支持按院系筛选教师
- 支持搜索教师姓名
- 提供分页和排序功能

### 3. 学生绑定教师
- 学生可以主动选择并绑定指导教师
- 防止重复绑定
- 验证教师身份和角色

### 4. 项目更新验证
- 项目提交后禁止修改指导老师
- 只有草稿状态的项目可以修改
- 严格的权限验证

---

## 响应格式

所有API接口都遵循统一的响应格式：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

### 状态码说明
- `200`: 操作成功
- `201`: 创建成功
- `400`: 请求参数错误
- `401`: 未认证或认证失败
- `403`: 权限不足
- `404`: 资源不存在
- `500`: 服务器内部错误

---

## 数据库表结构

### 核心表
1. **users** - 用户表
2. **user_profiles** - 用户详细信息表
3. **roles** - 角色表
4. **user_roles** - 用户角色关联表
5. **projects** - 项目表（包含teacher_id, submitted_at字段）
6. **project_members** - 项目成员表
7. **project_files** - 项目文件表
8. **project_reviews** - 项目审核记录表
9. **student_teacher** - 学生教师绑定关系表
10. **login_logs** - 登录日志表

---

## 技术栈

- **后端框架**: Gin (Go)
- **数据库**: MySQL 8.0
- **ORM**: GORM
- **认证**: JWT
- **文件上传**: 本地存储
- **API文档**: Markdown格式

---

## 部署信息

- **默认端口**: 8080
- **数据库端口**: 3306
- **环境**: 开发/生产环境
- **日志级别**: INFO
- **CORS**: 支持跨域请求

---

## 更新日志

### v2.0.0 (最新)
- ✅ 新增教师指导项目管理功能
- ✅ 新增教师列表院系筛选功能
- ✅ 新增学生绑定教师功能
- ✅ 增强项目更新验证机制
- ✅ 优化权限控制逻辑
- ✅ 完善错误处理机制 