# 云梦高校科研竞赛管理系统 - 脚本说明 v2.0

本文件夹包含云梦高校科研竞赛管理系统的核心启动和初始化脚本。

## 脚本列表

### 1. launch.bat - 完整启动脚本 v2.1

**功能说明：**
- 检查Go和MySQL环境
- 验证数据库连接
- 安装Go依赖
- 编译后端服务
- 启动后端服务
- 提供服务状态监控和重启功能

**使用方法：**
```bash
# 在scripts目录下运行
launch.bat
```

**主要特性：**
- 自动环境检查
- 智能数据库初始化
- 端口冲突检测和解决
- 详细的错误处理和提示
- 简化的服务启动流程
- 环境变量自动设置
- 改进的错误诊断

**默认配置：**
- 后端服务端口：8080
- 数据库：cloud_dream_system
- 默认用户：
  - 管理员：admin / 123456
  - 教师：teacher001 / 123456
  - 学生：student001 / 123456

**启动流程：**
1. 环境检查 - 检查Go和MySQL环境
2. 数据库连接测试 - 验证数据库连接
3. 依赖安装 - 安装和整理Go依赖
4. 服务启动 - 启动后端服务
5. 状态确认 - 显示服务信息

### 2. quick_launch.bat - 快速启动脚本 v1.0

**功能说明：**
- 快速环境检查
- 自动设置环境变量
- 简化的数据库连接测试
- 快速启动后端服务
- 适合日常开发使用

**使用方法：**
```bash
# 在scripts目录下运行
quick_launch.bat
```

**主要特性：**
- 快速环境检查
- 自动环境变量设置
- 简化的数据库连接测试
- 快速依赖检查
- 直接启动服务
- 适合日常开发

### 3. init_database.bat - 数据库初始化脚本 v2.0

**功能说明：**
- 创建数据库（如果不存在）
- 初始化数据库表结构
- 创建默认用户和角色
- 支持MySQL版本自动检测
- 智能SQL文件选择

**使用方法：**
```bash
# 在scripts目录下运行
init_database.bat
```

**初始化特性：**
- 自动MySQL版本检测
- 智能SQL文件选择（兼容版/标准版）
- 数据库清空选项
- 完整的验证流程
- 关键表检查
- 默认数据验证

**SQL文件选择：**
1. **兼容版SQL文件** - 推荐MySQL 8.0以下版本
2. **标准版SQL文件** - 推荐MySQL 8.0及以上版本
3. **自动选择** - 根据MySQL版本自动选择

**验证功能：**
- 表数量统计
- 关键表存在性检查
- 默认用户数据验证
- 数据库字符集验证

### 4. test_connection.bat - 数据库连接测试脚本 v2.0

**功能说明：**
- 测试MySQL连接
- 验证数据库参数
- 诊断连接问题
- 显示详细的错误信息
- 端口和网络连接测试

**使用方法：**
```bash
# 在scripts目录下运行
test_connection.bat
```

**测试项目：**
- MySQL服务连接
- 数据库存在性
- 表结构完整性
- 用户数据完整性
- 端口连接状态
- 网络连接状态

**适用场景：**
- 诊断launch.bat闪退问题
- 验证数据库连接参数
- 测试MySQL服务状态
- 网络连接问题排查

**测试总结：**
脚本会显示所有测试项目的状态，并提供详细的诊断信息和建议。

### 5. fix_admin_user.bat - 管理员用户修复脚本 v1.0

**功能说明：**
- 检查和创建管理员用户
- 修复用户角色分配
- 自动诊断权限问题
- 创建默认管理员账号

**使用方法：**
```bash
# 在go-backend目录下运行
scripts\fix_admin_user.bat
```

**修复功能：**
- 检查管理员用户是否存在
- 自动创建缺失的管理员用户
- 验证角色分配是否正确
- 修复角色关联问题
- 创建默认管理员账号：admin / 123456

**适用场景：**
- 403 Forbidden权限错误
- 管理员用户不存在
- 角色分配问题
- 权限系统故障

### 6. test_admin_permission.bat - 管理员权限测试脚本 v1.0

**功能说明：**
- 测试管理员登录功能
- 验证创建竞赛权限
- 自动API测试
- 权限系统验证

**使用方法：**
```bash
# 在go-backend目录下运行
scripts\test_admin_permission.bat
```

**测试项目：**
- 管理员登录API测试
- Token生成和验证
- 创建竞赛权限测试
- 权限中间件验证

**适用场景：**
- 修复后的验证测试
- 权限系统调试
- API功能验证
- 系统集成测试

## 环境要求

### 必需软件
- **Go 1.20+** - 后端开发语言
- **MySQL 5.7+** - 数据库服务器
- **Windows 10+** - 操作系统

### 推荐配置
- **Go 1.21+** - 最新稳定版本
- **MySQL 8.0+** - 最新稳定版本
- **8GB+ RAM** - 系统内存
- **SSD存储** - 数据库性能

## 快速开始

### 首次部署
1. **安装环境**
   ```bash
   # 安装Go: https://golang.org/dl/
   # 安装MySQL: https://dev.mysql.com/downloads/mysql/
   ```

2. **测试连接**
   ```bash
   cd go-backend/scripts
   test_connection.bat
   ```

3. **初始化数据库**
   ```bash
   init_database.bat
   ```

4. **启动服务**
   ```bash
   launch.bat
   ```

### 日常使用
```bash
# 快速启动（推荐）
quick_launch.bat

# 完整启动（包含详细检查）
launch.bat

# 服务启动后会自动显示访问地址
# 前端地址: http://localhost:5173
# 后端API地址: http://localhost:8080/api
```

## 故障排除

### 常见问题

**1. MySQL连接失败**
- 检查MySQL服务是否启动
- 验证用户名和密码
- 确认端口3306未被占用
- 检查防火墙设置

**2. Go编译失败**
- 检查Go版本（需要1.20+）
- 验证网络连接
- 清理go.mod缓存：`go clean -modcache`
- 重新下载依赖：`go mod tidy`

**3. 端口8080被占用**
- 脚本会自动检测并提供释放选项
- 手动释放：`netstat -ano | findstr :8080`
- 结束进程：`taskkill /f /pid <进程ID>`

**4. 数据库初始化失败**
- 检查MySQL版本兼容性
- 验证用户权限
- 查看SQL文件语法
- 检查磁盘空间

**5. 403 Forbidden权限错误**
- 运行fix_admin_user.bat修复管理员用户
- 使用管理员账号登录：admin / 123456
- 检查用户角色是否为admin
- 验证Token是否有效
- 运行test_admin_permission.bat测试权限

### 调试技巧

**1. 查看详细错误**
- 运行test_connection.bat获取详细诊断
- 检查MySQL错误日志
- 查看Go编译输出

**2. 手动验证**
```bash
# 测试MySQL连接
mysql -h localhost -P 3306 -u root -p

# 测试Go环境
go version
go mod tidy

# 测试编译
go build -o test.exe .
```

**3. 日志分析**
- 后端服务窗口输出
- 系统事件日志
- MySQL错误日志

## 更新日志

### v2.1 (2024-12-19)
- 修复数据库名称为cloud_dream_system
- 统一环境变量设置
- 改进服务启动流程（使用go run）
- 简化用户交互界面
- 增强错误处理和诊断
- 添加环境变量自动设置
- 优化启动脚本稳定性

### v1.0 (初始版本)
- 基础启动和初始化功能
- 简单的错误处理
- 基本的数据库管理

## 技术支持

如遇到问题，请：
1. 查看本文档的故障排除部分
2. 运行test_connection.bat进行诊断
3. 检查系统日志
4. 联系技术支持团队 